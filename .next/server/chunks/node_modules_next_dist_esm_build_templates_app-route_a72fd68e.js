module.exports=[16686,e=>{"use strict";var t=e.i(47909),a=e.i(74017),n=e.i(96250),r=e.i(59756),i=e.i(61916),o=e.i(14444),s=e.i(37092),l=e.i(69741),p=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),h=e.i(66012),g=e.i(70101),m=e.i(26937),f=e.i(10372),R=e.i(93695);e.i(52474);var E=e.i(220),w=e.i(89171),x=e.i(15638);function y(e,t){return new x.Paragraph({text:`${e}. ${t}`,heading:x.HeadingLevel.HEADING_1,spacing:{before:400,after:200},style:"Heading1"})}function T(){return new x.Paragraph({text:"═══════════════════════════════════════",alignment:x.AlignmentType.CENTER,spacing:{before:200,after:200}})}function v(e){let t=e.split("\n"),a=[];return t.forEach((e,n)=>{a.push(new x.TextRun({text:e,font:{name:"標楷體",eastAsia:"標楷體"},size:24})),n<t.length-1&&a.push(new x.TextRun({break:1}))}),new x.Paragraph({children:a,spacing:{line:360},alignment:x.AlignmentType.JUSTIFIED})}function A(e){try{let t,a,n,r,i=(t=e.includes(",")?e.split(",")[1]:e,Buffer.from(t,"base64")),o=e.startsWith("data:image/png")?"png":e.startsWith("data:image/jpeg")||e.startsWith("data:image/jpg")?"jpg":e.startsWith("data:image/gif")?"gif":e.startsWith("data:image/bmp")?"bmp":"png",{width:s,height:l}=function(e){if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return{width:e.readUInt32BE(16),height:e.readUInt32BE(20)};if(255===e[0]&&216===e[1]){let t=2;for(;t<e.length;){if(255===e[t]&&(192===e[t+1]||194===e[t+1])){let a=e.readUInt16BE(t+5);return{width:e.readUInt16BE(t+7),height:a}}if(255===e[t]){let a=e.readUInt16BE(t+2);t+=a+2}else t++}}return{width:1920,height:1080}}(i),{width:p,height:d}=(a=s/l,n=5.5,(r=5.5/a)>8.5&&(n=(r=8.5)*a),{width:n,height:r});return new x.Paragraph({children:[new x.ImageRun({type:o,data:Uint8Array.from(i),transformation:{width:(0,x.convertInchesToTwip)(p),height:(0,x.convertInchesToTwip)(d)}})],alignment:x.AlignmentType.CENTER,spacing:{before:200,after:200}})}catch(e){return console.error("圖片插入失敗:",e),new x.Paragraph({text:"[圖片載入失敗]",alignment:x.AlignmentType.CENTER,spacing:{before:200,after:200}})}}async function C(e,t,a){let n=[],r={echocardiography:"心臟超音波檢查",catheterization:"心導管檢查",ekg:"EKG 心電圖檢查","chest-xray":"Chest X-ray","heart-ct":"Heart CT","pulmonary-function":"肺功能檢查",abi:"四肢血流探測 (ABI)","myocardial-perfusion-scan":"心肌灌注掃描","vital-signs":"生理測量資訊","lab-report":"檢驗報告","medical-record":"就醫紀錄","medication-record":"就醫用藥","list-of-diagnosis":"List of Diagnosis (Problem List)","assessment-and-plan":"Assessment and Plan","sts-score":"STS Score",euroscore:"EuroSCORE"},i=1;return n.push(new x.Paragraph({text:"TAVI 事前審查",heading:x.HeadingLevel.TITLE,alignment:x.AlignmentType.CENTER,spacing:{before:0,after:400}})),n.push(v(t)),n.push(T()),["echocardiography","catheterization","ekg","chest-xray","heart-ct","pulmonary-function","abi","myocardial-perfusion-scan","vital-signs","lab-report","medical-record","medication-record","list-of-diagnosis","assessment-and-plan","sts-score","euroscore"].forEach(t=>{e.examinations.filter(e=>e.type===t).forEach(e=>{var t;let a,o=(t=i,(a=[]).push(y(t,r[e.type]||e.type)),e.textContent&&a.push(v(e.textContent)),"lab-report"===e.type&&e.labFindings&&a.push(new x.Paragraph({children:[new x.TextRun({text:"重要 Lab Findings：",font:{name:"標楷體",eastAsia:"標楷體"},size:24,bold:!0}),new x.TextRun({text:e.labFindings,font:{name:"標楷體",eastAsia:"標楷體"},size:24,color:"FF0000"})],spacing:{line:360}})),e.images&&e.images.length>0&&e.images.forEach(e=>{a.push(A(e))}),a.push(T()),a);n.push(...o),i++})}),n.push(y(i,"二位心臟外科專科醫師判定無法以傳統開心手術進行主動脈瓣膜置換或開刀危險性過高")),a?n.push(A(a)):n.push(new x.Paragraph({text:"[請在步驟 8 上傳已簽名的醫師評估文件]",alignment:x.AlignmentType.CENTER,spacing:{before:200,after:200},style:"Strong"})),new x.Document({sections:[{properties:{},children:n}],styles:{default:{document:{run:{font:{name:"Times New Roman",eastAsia:"標楷體"},size:24},paragraph:{spacing:{line:360},alignment:x.AlignmentType.JUSTIFIED}}},paragraphStyles:[{id:"Heading1",name:"Heading 1",basedOn:"Normal",next:"Normal",run:{size:28,bold:!0,font:{name:"Times New Roman",eastAsia:"標楷體"}},paragraph:{spacing:{before:400,after:200}}},{id:"Strong",name:"Strong",basedOn:"Normal",run:{bold:!0,color:"FF0000"}}]}})}async function b(e){try{let{caseData:t,summaryContent:a,signedDocumentBase64:n}=await e.json();if(!t||!t.patient)return w.NextResponse.json({error:"缺少病患資料"},{status:400});if(!a)return w.NextResponse.json({error:"缺少摘要內容，請先在步驟 7 生成醫師評估文件"},{status:400});let r=await C(t,a,n),i=await x.Packer.toBuffer(r),o=`${t.patient.name}${t.patient.chartNumber} - TAVI事前審查申請.docx`,s=encodeURIComponent(o);return new w.NextResponse(Uint8Array.from(i),{headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.wordprocessingml.document","Content-Disposition":`attachment; filename="${s}"; filename*=UTF-8''${s}`}})}catch(e){return console.error("完整申請文件生成失敗:",e),w.NextResponse.json({error:"文件生成失敗: "+e.message},{status:500})}}e.s(["POST",()=>b,"dynamic",0,"force-dynamic","maxDuration",0,60,"runtime",0,"nodejs"],99066);var N=e.i(99066);let P=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/docx/complete-application/route",pathname:"/api/docx/complete-application",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/docx/complete-application/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:I,workUnitAsyncStorage:S,serverHooks:U}=P;function O(){return(0,n.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:S})}async function H(e,t,n){P.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/docx/complete-application/route";w=w.replace(/\/index$/,"")||"/";let x=await P.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:y,params:T,nextConfig:v,parsedUrl:A,isDraftMode:C,prerenderManifest:b,routerServerContext:N,isOnDemandRevalidate:I,revalidateOnlyGenerated:S,resolvedPathname:U,clientReferenceManifest:O,serverActionsManifest:H}=x,_=(0,l.normalizeAppPath)(w),D=!!(b.dynamicRoutes[_]||b.routes[U]),F=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(D&&!C){let e=!!b.routes[U],t=b.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await F();throw new R.NoFallbackError}}let k=null;!D||P.isDev||C||(k="/index"===(k=U)?"/":k);let M=!0===P.isDev||!D,j=D&&!M;H&&O&&(0,o.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:O,serverActionsManifest:H,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:H})});let $=e.method||"GET",q=(0,i.getTracer)(),B=q.getActiveScopeSpan(),L={params:T,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>P.onRequestError(e,t,n,N)},sharedContext:{buildId:y}},K=new p.NodeNextRequest(e),z=new p.NodeNextResponse(t),W=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let o=async e=>P.handle(W,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${$} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${w}`)}),s=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var i,l;let p=async({previousCacheEntry:a})=>{try{if(!s&&I&&S&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(r);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let p=L.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(K,z,i,L.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);p&&(t[f.NEXT_CACHE_TAGS_HEADER]=p),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:I})},N),t}},d=await P.handleResponse({req:e,nextConfig:v,cacheKey:k,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:S,responseGenerator:p,waitUntil:n.waitUntil,isMinimalMode:s});if(!D)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",I?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&D||c.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(K,z,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};B?await l(B):await q.withPropagatedContext(e.headers,()=>q.trace(c.BaseServerSpan.handleRequest,{spanName:`${$} ${w}`,kind:i.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:I})}),D)throw t;return await (0,h.sendResponse)(K,z,new Response(null,{status:500})),null}}e.s(["handler",()=>H,"patchFetch",()=>O,"routeModule",()=>P,"serverHooks",()=>U,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>S],16686)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_a72fd68e.js.map
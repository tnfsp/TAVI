module.exports=[93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},16686,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(14444),o=e.i(37092),l=e.i(69741),p=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),h=e.i(66012),g=e.i(70101),m=e.i(26937),f=e.i(10372),x=e.i(93695);e.i(52474);var R=e.i(220),y=e.i(89171),v=e.i(15638);function w(e,t){return new v.Paragraph({text:`${e}. ${t}`,heading:v.HeadingLevel.HEADING_1,spacing:{before:400,after:200},style:"Heading1"})}function E(){return new v.Paragraph({text:"═══════════════════════════════════════",alignment:v.AlignmentType.CENTER,spacing:{before:200,after:200}})}function T(e){return new v.Paragraph({children:[new v.TextRun({text:e,font:{name:"標楷體",eastAsia:"標楷體"},size:24})],spacing:{line:360},alignment:v.AlignmentType.JUSTIFIED})}function b(e,t=6){try{let a,r=(a=e.includes(",")?e.split(",")[1]:e,Buffer.from(a,"base64")),n=e.startsWith("data:image/png")?"png":e.startsWith("data:image/jpeg")||e.startsWith("data:image/jpg")?"jpg":e.startsWith("data:image/gif")?"gif":e.startsWith("data:image/bmp")?"bmp":"png";return new v.Paragraph({children:[new v.ImageRun({type:n,data:Uint8Array.from(r),transformation:{width:(0,v.convertInchesToTwip)(t),height:(0,v.convertInchesToTwip)(.75*t)}})],alignment:v.AlignmentType.CENTER,spacing:{before:200,after:200}})}catch(e){return console.error("圖片插入失敗:",e),new v.Paragraph({text:"[圖片載入失敗]",alignment:v.AlignmentType.CENTER,spacing:{before:200,after:200}})}}async function A(e,t,a){let r=[],n={echocardiography:"心臟超音波檢查",catheterization:"心導管檢查",ekg:"EKG 心電圖檢查","chest-xray":"Chest X-ray","heart-ct":"Heart CT","pulmonary-function":"肺功能檢查",abi:"四肢血流探測 (ABI)","myocardial-perfusion-scan":"心肌灌注掃描","vital-signs":"生理測量資訊","lab-report":"檢驗報告","medical-record":"就醫紀錄","medication-record":"就醫用藥","list-of-diagnosis":"List of Diagnosis (Problem List)","assessment-and-plan":"Assessment and Plan","sts-score":"STS Score",euroscore:"EuroSCORE"},i=1;return r.push(new v.Paragraph({text:"TAVI 事前審查",heading:v.HeadingLevel.TITLE,alignment:v.AlignmentType.CENTER,spacing:{before:0,after:400}})),r.push(T(t)),r.push(E()),["echocardiography","catheterization","ekg","chest-xray","heart-ct","pulmonary-function","abi","myocardial-perfusion-scan","vital-signs","lab-report","medical-record","medication-record","list-of-diagnosis","assessment-and-plan","sts-score","euroscore"].forEach(t=>{e.examinations.filter(e=>e.type===t).forEach(e=>{var t;let a,s=(t=i,(a=[]).push(w(t,n[e.type]||e.type)),e.textContent&&a.push(T(e.textContent)),"lab-report"===e.type&&e.labFindings&&a.push(new v.Paragraph({children:[new v.TextRun({text:"重要 Lab Findings：",font:{name:"標楷體",eastAsia:"標楷體"},size:24,bold:!0}),new v.TextRun({text:e.labFindings,font:{name:"標楷體",eastAsia:"標楷體"},size:24,color:"FF0000"})],spacing:{line:360}})),e.images&&e.images.length>0&&e.images.forEach(e=>{a.push(b(e))}),a.push(E()),a);r.push(...s),i++})}),r.push(w(i,"二位心臟外科專科醫師判定無法以傳統開心手術進行主動脈瓣膜置換或開刀危險性過高")),a?r.push(b(a,7)):r.push(new v.Paragraph({text:"[請在步驟 8 上傳已簽名的醫師評估文件]",alignment:v.AlignmentType.CENTER,spacing:{before:200,after:200},style:"Strong"})),new v.Document({sections:[{properties:{},children:r}],styles:{default:{document:{run:{font:{name:"Times New Roman",eastAsia:"標楷體"},size:24},paragraph:{spacing:{line:360},alignment:v.AlignmentType.JUSTIFIED}}},paragraphStyles:[{id:"Heading1",name:"Heading 1",basedOn:"Normal",next:"Normal",run:{size:28,bold:!0,font:{name:"Times New Roman",eastAsia:"標楷體"}},paragraph:{spacing:{before:400,after:200}}},{id:"Strong",name:"Strong",basedOn:"Normal",run:{bold:!0,color:"FF0000"}}]}})}async function C(e){try{let{caseData:t,summaryContent:a,signedDocumentBase64:r}=await e.json();if(!t||!t.patient)return y.NextResponse.json({error:"缺少病患資料"},{status:400});if(!a)return y.NextResponse.json({error:"缺少摘要內容，請先在步驟 7 生成醫師評估文件"},{status:400});let n=await A(t,a,r),i=await v.Packer.toBuffer(n),s=`${t.patient.name}${t.patient.chartNumber} - TAVI事前審查申請.docx`,o=encodeURIComponent(s);return new y.NextResponse(Uint8Array.from(i),{headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.wordprocessingml.document","Content-Disposition":`attachment; filename="${o}"; filename*=UTF-8''${o}`}})}catch(e){return console.error("完整申請文件生成失敗:",e),y.NextResponse.json({error:"文件生成失敗: "+e.message},{status:500})}}e.s(["POST",()=>C],99066);var N=e.i(99066);let P=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/docx/complete-application/route",pathname:"/api/docx/complete-application",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/docx/complete-application/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:S,workUnitAsyncStorage:I,serverHooks:O}=P;function j(){return(0,r.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:I})}async function k(e,t,r){P.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/docx/complete-application/route";y=y.replace(/\/index$/,"")||"/";let v=await P.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:E,nextConfig:T,parsedUrl:b,isDraftMode:A,prerenderManifest:C,routerServerContext:N,isOnDemandRevalidate:S,revalidateOnlyGenerated:I,resolvedPathname:O,clientReferenceManifest:j,serverActionsManifest:k}=v,H=(0,l.normalizeAppPath)(y),U=!!(C.dynamicRoutes[H]||C.routes[O]),_=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,b,!1):t.end("This page could not be found"),null);if(U&&!A){let e=!!C.routes[O],t=C.dynamicRoutes[H];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await _();throw new x.NoFallbackError}}let q=null;!U||P.isDev||A||(q="/index"===(q=O)?"/":q);let D=!0===P.isDev||!U,F=U&&!D;k&&j&&(0,s.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:j,serverActionsManifest:k,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:k})});let M=e.method||"GET",$=(0,i.getTracer)(),L=$.getActiveScopeSpan(),K={params:E,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>P.onRequestError(e,t,r,N)},sharedContext:{buildId:w}},z=new p.NodeNextRequest(e),B=new p.NodeNextResponse(t),W=d.NextRequestAdapter.fromNodeNextRequest(z,(0,d.signalFromNodeResponse)(t));try{let s=async e=>P.handle(W,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${M} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${y}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let p=async({previousCacheEntry:a})=>{try{if(!o&&S&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let p=K.renderOpts.collectedTags;if(!U)return await (0,h.sendResponse)(z,B,i,K.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);p&&(t[f.NEXT_CACHE_TAGS_HEADER]=p),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,r=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:S})},N),t}},d=await P.handleResponse({req:e,nextConfig:T,cacheKey:q,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:I,responseGenerator:p,waitUntil:r.waitUntil,isMinimalMode:o});if(!U)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",S?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&U||c.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(z,B,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};L?await l(L):await $.withPropagatedContext(e.headers,()=>$.trace(c.BaseServerSpan.handleRequest,{spanName:`${M} ${y}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof x.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:H,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:S})}),U)throw t;return await (0,h.sendResponse)(z,B,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>j,"routeModule",()=>P,"serverHooks",()=>O,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>I],16686)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a2a26b16._.js.map